# .shellrc
export DEBUG_INIT_SCRIPTS="${DEBUG_INIT_SCRIPTS:-} .shellrc"

export PATH="$HOME/opt/ocdev:$PATH"
CDPATH=".:$HOME/src/github.com/dmage"

# golang
export GOPATH="$HOME"
export PATH="$GOPATH/bin:$PATH"

cover() {
    local t="/tmp/go-cover.$$.tmp"
    go test -coverprofile="$t" "$@" && go tool cover -html="$t" && rm "$t"
}

goenv() {
    local version=$1
    shift
    local goversion=$(
        if [ -e "$HOME/goroot/$version" ]; then
            echo "$version/"
        else
            cd "$HOME/goroot"
            echo "go$version"*/
        fi
    )
    if [ -e "$HOME/goroot/$goversion" ]; then
        env GOROOT="$HOME/goroot/$goversion" PATH="$HOME/goroot/$goversion/bin:$PATH" "$@"
    elif [ "$goversion" == "go$version*/" ]; then
        echo "goenv: $version: no such version" >&2
        return 1
    else
        echo "goenv: $version: ambiguous version: $goversion" >&2
        return 1
    fi
}

gocd() {
    cd "$GOPATH/src/$@"
}

govim() {
    vim "$GOPATH/src/$@"
}

# fix $TERM in tmux
[ -n "$TMUX" ] && export TERM=screen-256color

# temporary workdirs
wd() {
    local name="${1-}"
    if [ -z "$name" ]; then
        echo "usage: wd <name>"
        return 1
    fi
    if [ -d "$HOME/src/github.com/dmage/workdir/"*"$name"* ]; then
        cd "$HOME/src/github.com/dmage/workdir/"*"$name"*
    else
        local dirname="$(date +%Y-%m)-$name"
        mkdir -p "$HOME/src/github.com/dmage/workdir/$dirname"
        cd "$HOME/src/github.com/dmage/workdir/$dirname"
    fi
}

# virtualenvs
ve-data() {
    virtualenv "$HOME/.local/share/ve-data"
    . "$HOME/.local/share/ve-data/bin/activate"
    pip install numpy pandas matplotlib jupyterlab ipympl pyyaml
}

# source other files
[ -f ~/.shell_aliases ] && . ~/.shell_aliases
[ -f ~/.shellrc.local ] && . ~/.shellrc.local

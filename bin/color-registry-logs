#!/bin/sh

# colors
ESC=$(printf '\033')
C_RESET="$ESC[0m"
C_ERROR="$ESC[0;31m"
C_WARN="$ESC[0;33m"
C_INFO="$ESC[0;36m"
C_DEBUG="$ESC[0;34m"
C_HTTP="$ESC[0;38;5;15m"
C_SUCCESS="$ESC[1;32m"
C_FAIL="$ESC[1;31m"

# sed expressions
WORD="[^ ]\+"
DATE="\[[^]]*\]"
QQCHAR='\([^"\]\|\\.\)'
QQSTRING="\"$QQCHAR*\""

exec sed -u -e "
    /^=/ {
        s/^/$C_HTTP/
    }
    /^time/ {
        s/.*level=debug/$C_DEBUG&$C_RESET/
        s/.*level=info/$C_INFO&$C_RESET/
        s/.*level=warning/$C_WARN&$C_RESET/
        s/.*level=error/$C_ERROR&$C_RESET/
        s/msg=\"$QQCHAR*\(error\|cannot\)$QQCHAR*\"/$C_FAIL&$C_RESET/g
    }
    /^[0-9]/ {
        s/^/$C_HTTP/
        s/^\($WORD $WORD $WORD $DATE $QQSTRING \)\(2[0-9][0-9]\) /\1$C_SUCCESS\3$C_HTTP /
        s/^\($WORD $WORD $WORD $DATE $QQSTRING \)\([345][0-9][0-9]\) /\1$C_FAIL\3$C_HTTP /
        s/$/$C_RESET/
    }
"
